/*!
 * Spiral Image Cropper Widget v0.4.0
 * https://github.com/spiral-modules/image-cropper/
 * Copyright (c) 2016, Alex Chepura, Yauheni Yasinau, spiralscout.com
 */
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("sf"));else if("function"==typeof define&&define.amd)define(["sf"],e);else{var s=e("object"==typeof exports?require("sf"):t.sf);for(var i in s)("object"==typeof exports?exports:t)[i]=s[i]}}(this,function(t){return function(t){function e(i){if(s[i])return s[i].exports;var o=s[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var s={};return e.m=t,e.c=s,e.p="",e(0)}([function(t,e,s){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}var o=s(1),r=i(o),n=s(2),c=i(n);s(7),r["default"].instancesController.registerInstanceType(c["default"],"js-sf-cropper"),t.exports=c["default"]},function(e,s){e.exports=t},function(t,e,s){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}var o=s(3),r=i(o);Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=void 0;var n=s(1),c=i(n),a={template:s(6)},h=function(t,e,s){this._construct(t,e,s)};h.prototype=(0,r["default"])(c["default"].modules.core.BaseDOMConstructor.prototype),h.prototype.name="crop",h.prototype._construct=function(t,e,s){this.init(t,e,s),this.options.template=this.options.template||a.template;var i=this,o=function(){},r=new DOMParser;if(s&&(this.options=t.tools.extend(this.options,s)),"string"==typeof this.options.info&&(this.options.info=this.options.info.split(",")),this.options.ratio&&(this.options.ratio=parseFloat(this.options.ratio)),"function"!=typeof this.options.onFileProcessed&&(this.options.onFileProcessed=o),this.els={node:e,input:"INPUT"===e.tagName?e:e.getElementsByClassName("sf-crop-input")[0],modal:r.parseFromString(this.options.template,"text/html").firstChild.lastChild.getElementsByClassName("sf-crop-modal")[0],backdrop:r.parseFromString(this.options.template,"text/html").firstChild.lastChild.getElementsByClassName("sf-crop-backdrop")[0]},this.options.fileNameSelector&&(" "===this.options.fileNameSelector.charAt(0)?this.els.filenameContainer=document.querySelector(this.options.fileNameSelector):this.els.filenameContainer=("INPUT"===e.tagName?e.parentNode:e).querySelector(this.options.fileNameSelector)),this.options.preview?this.els.preview=document.querySelector(this.options.preview):console.warn("Cropper: no preview provided"),this.options.adjust&&(this.els.adjust=" "===this.options.adjust.charAt(0)?document.querySelector(this.options.adjust):("INPUT"===e.tagName?e.parentNode:e).querySelector(this.options.adjust)),this.options.ajaximage||this.els.input||console.warn("Provide file-input to use cropper or load image with ajax (with data-ajaximage attr)"),this.els.cropWrapper=this.els.modal.getElementsByClassName("sf-crop-wrapper")[0],this.els.imageOriginal=this.els.modal.getElementsByClassName("sf-crop-image-original")[0],this.els.cropElements=this.els.modal.getElementsByClassName("sf-crop-elements")[0],this.els.cropSave=this.els.modal.getElementsByClassName("sf-crop-save")[0],this.els.cropSave&&(this.els.cropSave.innerText=this.options.saveBtnText,this.options.customBtnClass?this.els.cropSave.classList.add(this.options.customBtnClass):""),this.els.closePopup=this.els.modal.getElementsByClassName("sf-crop-close")[0],this.els.closePopup&&(this.els.closePopup.innerText=this.options.closeBtnText,this.options.customBtnClass?this.els.closePopup.classList.add(this.options.customBtnClass):""),this.els.cropInfo={ratio:this.els.modal.getElementsByClassName("sf-crop-ratio")[0],croppedSize:this.els.modal.getElementsByClassName("sf-crop-cropped-size")[0],origSize:this.els.modal.getElementsByClassName("sf-crop-orig-size")[0]},this.els.handlers={n:this.els.modal.getElementsByClassName("handler-N")[0],ne:this.els.modal.getElementsByClassName("handler-NE")[0],e:this.els.modal.getElementsByClassName("handler-E")[0],se:this.els.modal.getElementsByClassName("handler-SE")[0],s:this.els.modal.getElementsByClassName("handler-S")[0],sw:this.els.modal.getElementsByClassName("handler-SW")[0],w:this.els.modal.getElementsByClassName("handler-W")[0],nw:this.els.modal.getElementsByClassName("handler-NW")[0],current:null},this.els.dimmers={el:this.els.modal.getElementsByClassName("dimmers")[0],n:this.els.modal.getElementsByClassName("dimmer-N")[0],e:this.els.modal.getElementsByClassName("dimmer-E")[0],s:this.els.modal.getElementsByClassName("dimmer-S")[0],w:this.els.modal.getElementsByClassName("dimmer-W")[0]},this.els.form=this.els.input?this.els.input.form:"",this.form=t.instancesController.getInstance("form",this.els.form),this.reset(),this.addEventListeners(),this.attachData(),this.options.ajaximage){this.els.input&&this.els.input!==this.els.node&&this.els.input.parentNode.removeChild(this.els.input);var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var t=new Image,e=window.URL||window.webkitURL;this.response instanceof Blob?(t.src=e.createObjectURL(this.response),i.handleFileSelect(this.response)):i.els.adjust.parentNode.removeChild(i.els.adjust)}},n.open("GET",i.options.ajaximage),n.responseType="blob",n.send()}-1!=navigator.appVersion.indexOf("MSIE 10")&&(this.els.cropElements.style.backgroundColor="rgba(255,255,255,0.01")},h.prototype.optionsToGrab={format:{value:"cropped",domAttr:"data-format"},ajaximage:{value:!1,domAttr:"data-ajax-image"},template:{domAttr:"data-template"},ajaxAddress:{value:!1,domAttr:"data-ajax-address"},ratio:{value:!1,domAttr:"data-ratio"},fileNameSelector:{domAttr:"data-filename-selector"},info:{value:[],domAttr:"data-info"},preview:{value:"",domAttr:"data-preview"},saveBtnText:{value:"Save",domAttr:"data-save-btn-text"},closeBtnText:{value:"Close",domAttr:"data-close-btn-text"},customBtnClass:{domAttr:"data-custom-btn-class"},adjust:{value:"",domAttr:"data-adjust"},name:{value:"cropped",domAttr:"data-name"}},h.prototype.reset=function(){this.cnv={cursor:{x:0,y:0},crop:{x:0,y:0,x2:0,y2:0,w:0,h:0},toSave:{x:0,y:0,w:0,h:0},image:{w:0,h:0},old:{cursor:{x:0,y:0}},start:{crop:{x:0,y:0,w:0,h:0}},canvas:{w:0,h:0},orig:{},preview:{w:0,h:0},scale:1},this.setTop(0),this.setLeft(0),this.setWidth(0),this.setHeight(0),this.els.imageOriginal.lastChild&&this.els.imageOriginal.removeChild(this.els.imageOriginal.lastChild)},h.prototype.changeInfo=function(t,e){switch(t){case"ratio":this.els.cropInfo.ratio.innerHTML="Aspect ratio: "+e;break;case"croppedSize":this.els.cropInfo.croppedSize.innerHTML="Cropped size: "+e[0]+"x"+e[1];break;case"origSize":this.els.cropInfo.origSize.innerHTML="Original size: "+e[0]+"x"+e[1]}},h.prototype.updateInfo=function(){var t=this;this.options.info.length>0&&this.options.info.forEach(function(e){"ratio"==e&&t.changeInfo("ratio",Math.round(t.cnv.crop.w/t.cnv.crop.h*100)/100),"croppedSize"==e&&t.changeInfo("croppedSize",[Math.round(t.cnv.crop.w*t.cnv.scale),Math.round(t.cnv.crop.h*t.cnv.scale)])})},h.prototype.showPopup=function(){var t=this;document.body.appendChild(this.els.modal),document.body.appendChild(this.els.backdrop),setTimeout(function(){t.els.modal.classList.add("visible"),t.els.backdrop.classList.add("visible")},0),this.addModalEventListeners(),this.removeEventListeners()},h.prototype.hidePopup=function(){var t=this;this.els.modal.classList.remove("visible"),this.els.backdrop.classList.remove("visible"),setTimeout(function(){t.els.modal.parentNode.removeChild(t.els.modal),t.els.backdrop.parentNode.removeChild(t.els.backdrop)},300),this.removeModalEventListeners(),this.addEventListeners()},h.prototype.addEventListeners=function(){var t=this;this._inputChange=function(e){var s=e.target.files[0];return s.type.match(/image/)?(t.handleFileSelect(s),void(t.els.adjust&&(t.els.adjust.style.display="inline-block"))):void alert("Please select an image.")},this._openCropper=function(e){t.img&&(t.readyToPrepare&&t.prepare(),t.showPopup())},this.els.input&&this.els.input.addEventListener("change",this._inputChange),this.els.preview&&this.els.preview.addEventListener("click",this._openCropper),this.els.adjust&&this.els.adjust.addEventListener("click",this._openCropper)},h.prototype.removeEventListeners=function(){this.els.input&&this.els.input.removeEventListener("change",this._inputChange),this.els.preview&&this.els.preview.removeEventListener("click",this._openCropper),this.els.adjust&&this.els.adjust.removeEventListener("click",this._openCropper)},h.prototype.addModalEventListeners=function(){var t=this;this._cropSave=function(){t.save(),t.hidePopup()},this._hidePopup=function(){t.hidePopup()},this._cropWrapperMouseDown=function(e){t.onCropStart(e),t.inCropping=!0},this._documentMouseMove=function(e){t.inCropping&&(e.preventDefault(),t.onCrop(e))},this._cropWrapperMouseUp=function(){t.onCropEnd(),t.inCropping=!1},this._documentMouseUp=function(){t.onCropEnd(),t.inCropping=!1},this.els.closePopup.addEventListener("click",this._hidePopup),this.els.backdrop.addEventListener("click",this._hidePopup),this.els.cropSave.addEventListener("click",this._cropSave),this.els.cropWrapper.addEventListener("mousedown",this._cropWrapperMouseDown),this.els.cropWrapper.addEventListener("touchstart",this._cropWrapperMouseDown),this.els.cropWrapper.addEventListener("mouseup",this._cropWrapperMouseUp),this.els.cropWrapper.addEventListener("touchend",this._cropWrapperMouseUp),document.addEventListener("mousemove",this._documentMouseMove),document.addEventListener("touchmove",this._documentMouseMove),document.addEventListener("mouseup",this._documentMouseUp),document.addEventListener("touchend",this._documentMouseUp)},h.prototype.removeModalEventListeners=function(){this.els.closePopup.removeEventListener("click",this._hidePopup),this.els.backdrop.removeEventListener("click",this._hidePopup),this.els.cropSave.removeEventListener("click",this._cropSave),this.els.cropWrapper.removeEventListener("mousedown",this._cropWrapperMouseDown),this.els.cropWrapper.removeEventListener("touchstart",this._cropWrapperMouseDown),this.els.cropWrapper.removeEventListener("mouseup",this._cropWrapperMouseUp),this.els.cropWrapper.removeEventListener("touchend",this._cropWrapperMouseUp),document.removeEventListener("mousemove",this._documentMouseMove),document.removeEventListener("touchmove",this._documentMouseMove),document.removeEventListener("mouseup",this._documentMouseUp),document.removeEventListener("touchend",this._documentMouseUp)},h.prototype.setPreviewImage=function(t){var e=this;if(e.els.preview){for(;e.els.preview.firstChild;)e.els.preview.removeChild(e.els.preview.firstChild);var s=t.cloneNode(!0);s.style.maxWidth="100%",e.els.preview.appendChild(s)}},h.prototype.handleFileSelect=function(t){var e=this;this.reader=new FileReader,this.reset(),this.reader.onload=function(t){return function(s){e.file={file:t,blob:t,name:encodeURIComponent(t.name?t.name:e.options.ajaximage.replace(/^.*[\\\/]/,"")),base64:s.target.result},e.els.filenameContainer&&(e.els.filenameContainer.innerText=e.file.name),e.img=new Image,e.img.src=e.file.base64,e.img.onload=function(){e.setPreviewImage(e.img),e.cnv.preview.h=e.img.clientHeight,e.cnv.preview.w=e.img.clientWidth,e.cnv.orig.h=e.img.naturalHeight,e.cnv.orig.w=e.img.naturalWidth,e.cnv.orig.ratio=e.cnv.orig.w/e.cnv.orig.h;var t=.7;e.cnv.orig.h<window.innerHeight*t&&e.cnv.orig.w<window.innerWidth*t?e.cnv.canvas.w=e.cnv.orig.w:e.cnv.orig.ratio>window.innerWidth/window.innerHeight?e.cnv.canvas.w=window.innerWidth*t:e.cnv.canvas.w=Math.floor(e.cnv.orig.w*window.innerHeight/e.cnv.orig.h)*t,e.cnv.scale=e.cnv.orig.w/e.cnv.canvas.w,e.cnv.toSave.w=e.cnv.orig.w,e.cnv.toSave.h=e.cnv.orig.h,e.els.imageOriginal.lastChild&&e.els.imageOriginal.removeChild(e.els.imageOriginal.lastChild),e.readyToPrepare=!0,e.options.onFileProcessed()}}}(t),this.reader.readAsDataURL(t)},h.prototype.prepare=function(){function t(){try{i.drawImage(e.img,0,0,e.cnv.canvas.w,e.cnv.canvas.w/e.cnv.orig.ratio)}catch(s){if("NS_ERROR_NOT_AVAILABLE"!=s.name)throw s;setTimeout(t,0)}}var e=this,s=document.createElement("canvas");s.width=e.cnv.canvas.w,s.height=e.cnv.canvas.w/e.cnv.orig.ratio;var i=s.getContext("2d");t(),e.els.imageOriginal.appendChild(s),setTimeout(function(){if(e.cnv.image.w=e.els.imageOriginal.lastChild.clientWidth,e.cnv.image.h=e.els.imageOriginal.lastChild.clientHeight,e.cnv.start.crop.w=e.cnv.image.w,e.cnv.start.crop.h=e.cnv.image.h,e.setWidth(e.cnv.image.w),e.setHeight(e.cnv.image.h),e.cnv.crop.x2=e.cnv.image.w,e.cnv.crop.y2=e.cnv.image.h,e.options.ratio){if(e.cnv.orig.ratio>e.options.ratio){var t=e.cnv.crop.w;e.setWidth(Math.round(e.cnv.start.crop.h*e.options.ratio)),e.cnv.start.crop.w=e.cnv.crop.w,e.setLeft(Math.round((t-e.cnv.crop.w)/2)),e.cnv.crop.x2=e.cnv.crop.x+e.cnv.crop.w}else{var s=e.cnv.crop.h;e.setHeight(Math.round(e.cnv.start.crop.w/e.options.ratio)),e.cnv.start.crop.h=e.cnv.crop.h,e.setTop(Math.round((s-e.cnv.crop.h)/2)),e.cnv.crop.y2=e.cnv.crop.y+e.cnv.crop.h}e.save()}e.updateInfo(),e.options.info.indexOf("origSize")>-1&&e.changeInfo("origSize",[e.cnv.orig.w,e.cnv.orig.h]),e.readyToPrepare=!1},50)},h.prototype.onCropStart=function(t){"touchstart"===t.type&&(t=t.touches[0]),this.els.handlers.current=t.target,this.cnv.offset=this.els.cropWrapper.getBoundingClientRect(),this.cnv.cursor.x=Math.round(t.clientX-this.cnv.offset.left),this.cnv.cursor.y=Math.round(t.clientY-this.cnv.offset.top),this.cnv.cursor.offsetX=void 0===t.offsetX?t.layerX?Math.round(t.layerX):t.pageX-t.target.getBoundingClientRect().left:Math.round(t.offsetX),this.cnv.cursor.offsetY=void 0===t.offsetY?t.layerY?Math.round(t.layerY):t.pageY-t.target.getBoundingClientRect().top:Math.round(t.offsetY)},h.prototype.onCrop=function(t){if(this.els.handlers.current){switch("touchmove"===t.type&&(t=t.touches[0]),this.cnv.cursor.x=Math.round(t.clientX-this.cnv.offset.left),this.cnv.cursor.y=Math.round(t.clientY-this.cnv.offset.top),this.els.handlers.current){case this.els.handlers.n:this.setN();break;case this.els.handlers.ne:this.setNE();break;case this.els.handlers.e:this.setE();break;case this.els.handlers.se:this.setSE();break;case this.els.handlers.s:this.setS();break;case this.els.handlers.sw:this.setSW();break;case this.els.handlers.w:this.setW();break;case this.els.handlers.nw:this.setNW();break;case this.els.cropElements:this.move()}this.updateInfo()}},h.prototype.onCropEnd=function(){this.els.handlers.current=null},h.prototype.setLeft=function(t){this.cnv.crop.x=t,this.els.cropElements.style.left=t+"px",this.els.dimmers.el.style.left=t+"px"},h.prototype.setTop=function(t){this.cnv.crop.y=t,this.els.cropElements.style.top=t+"px",this.els.dimmers.el.style.top=t+"px"},h.prototype.setWidth=function(t){this.cnv.crop.w=t,this.els.cropElements.style.width=t+"px",this.els.dimmers.el.style.width=t+"px"},h.prototype.setHeight=function(t){this.cnv.crop.h=t,this.els.cropElements.style.height=t+"px",this.els.dimmers.el.style.height=t+"px"},h.prototype.adjustN=function(t,e){t?(this.cnv.crop.y2-e)*this.options.ratio<=this.cnv.crop.x2?(this.setTop(e),this.setHeight(this.cnv.crop.y2-e),this.setWidth(Math.round(this.cnv.crop.h*this.options.ratio)),this.setLeft(this.cnv.crop.x2-this.cnv.crop.w)):(this.setLeft(0),this.setWidth(this.cnv.crop.x2),this.setTop(this.cnv.crop.y2-Math.round(this.cnv.crop.w/this.options.ratio))):(this.cnv.crop.y2-e)*this.options.ratio+this.cnv.crop.x<=this.cnv.image.w?(this.setTop(e),this.setHeight(this.cnv.crop.y2-e),this.setWidth(Math.round(this.cnv.crop.h*this.options.ratio)),this.cnv.crop.x2=this.cnv.crop.x+this.cnv.crop.w):(this.setWidth(this.cnv.image.w-this.cnv.crop.x),this.setTop(this.cnv.crop.y2-Math.round(this.cnv.crop.w/this.options.ratio)),this.setHeight(this.cnv.crop.y2-this.cnv.crop.y),this.cnv.crop.x2=this.cnv.image.w)},h.prototype.setN=function(t){this.options.ratio?this.cnv.cursor.y>0?this.cnv.cursor.y<this.cnv.crop.y2?this.adjustN(t,this.cnv.cursor.y):(this.setHeight(1),this.setWidth(Math.round(this.cnv.crop.h*this.options.ratio)),t?this.setLeft(this.cnv.crop.x2-1):this.cnv.crop.x2=this.cnv.crop.x+this.cnv.crop.w,this.setTop(this.cnv.crop.y2-1)):this.adjustN(t,0):this.cnv.cursor.y>0?this.cnv.cursor.y<this.cnv.crop.y2?(this.setTop(this.cnv.cursor.y),this.setHeight(this.cnv.crop.y2-this.cnv.crop.y)):(this.setTop(this.cnv.crop.y2-1),this.setHeight(1)):(this.setTop(0),this.setHeight(this.cnv.crop.y2))},h.prototype.adjustS=function(t,e){t?(e-this.cnv.crop.y)*this.options.ratio<=this.cnv.crop.x2?(this.setHeight(e-this.cnv.crop.y),this.setWidth(Math.round(this.cnv.crop.h*this.options.ratio)),this.setLeft(this.cnv.crop.x2-this.cnv.crop.w),this.cnv.crop.y2=e):(this.setLeft(0),this.setWidth(this.cnv.crop.x2),this.setHeight(Math.round(this.cnv.crop.w/this.options.ratio)),this.cnv.crop.y2=this.cnv.crop.y+this.cnv.crop.h):(e-this.cnv.crop.y)*this.options.ratio+this.cnv.crop.x<=this.cnv.image.w?(this.setHeight(e-this.cnv.crop.y),this.setWidth(Math.round(this.cnv.crop.h*this.options.ratio)),this.cnv.crop.y2=e,this.cnv.crop.x2=this.cnv.crop.x+this.cnv.crop.w):(this.setWidth(this.cnv.image.w-this.cnv.crop.x),this.setHeight(Math.round(this.cnv.crop.w/this.options.ratio)),this.cnv.crop.x2=this.cnv.image.w,this.cnv.crop.y2=this.cnv.crop.y+this.cnv.crop.h)},h.prototype.setS=function(t){this.options.ratio?this.cnv.cursor.y<this.cnv.image.h?this.cnv.cursor.y>this.cnv.crop.y?this.adjustS(t,this.cnv.cursor.y):(this.setHeight(1),this.setWidth(Math.round(this.cnv.crop.h*this.options.ratio)),t?this.setLeft(this.cnv.crop.x2-1):this.cnv.crop.x2=this.cnv.crop.x+this.cnv.crop.w,this.cnv.crop.y2=this.cnv.crop.y+1):this.adjustS(t,this.cnv.image.h):this.cnv.cursor.y<this.cnv.image.h?this.cnv.cursor.y>this.cnv.crop.y?(this.setHeight(this.cnv.cursor.y-this.cnv.crop.y),this.cnv.crop.y2=this.cnv.cursor.y):(this.setHeight(1),this.cnv.crop.y2=this.cnv.crop.y+1):(this.setHeight(this.cnv.image.h-this.cnv.crop.y),this.cnv.crop.y2=this.cnv.image.h)},h.prototype.adjustW=function(t,e){t?this.cnv.crop.y2-(this.cnv.crop.x2-e)/this.options.ratio>=0?(this.setLeft(e),this.setWidth(this.cnv.crop.x2-e),this.setHeight(Math.round(this.cnv.crop.w/this.options.ratio)),this.setTop(this.cnv.crop.y2-this.cnv.crop.h)):(this.setTop(0),this.setHeight(this.cnv.crop.y2),this.setWidth(Math.round(this.cnv.crop.h*this.options.ratio)),this.setLeft(this.cnv.crop.x2-this.cnv.crop.w)):(this.cnv.crop.x2-e)/this.options.ratio+this.cnv.crop.y<=this.cnv.image.h?(this.setLeft(e),this.setWidth(this.cnv.crop.x2-e),this.setHeight(Math.round(this.cnv.crop.w/this.options.ratio)),this.cnv.crop.y2=this.cnv.crop.y+this.cnv.crop.h):(this.setHeight(this.cnv.image.h-this.cnv.crop.y),this.setWidth(Math.round(this.cnv.crop.h*this.options.ratio)),this.setLeft(this.cnv.crop.x2-this.cnv.crop.w),this.cnv.crop.y2=this.cnv.image.h)},h.prototype.setW=function(t){this.options.ratio?this.cnv.cursor.x>0?this.cnv.cursor.x<this.cnv.crop.x2?this.adjustW(t,this.cnv.cursor.x):(this.setWidth(1),this.setHeight(Math.round(this.cnv.crop.w/this.options.ratio)),t?this.setTop(this.cnv.crop.y2-1):this.cnv.crop.y2=this.cnv.crop.y+this.cnv.crop.h):this.adjustW(t,0):this.cnv.cursor.x>0?this.cnv.cursor.x<this.cnv.crop.x2?(this.setLeft(this.cnv.cursor.x),this.setWidth(this.cnv.crop.x2-this.cnv.crop.x)):(this.setLeft(this.cnv.crop.x2-1),this.setWidth(1)):(this.setLeft(0),this.setWidth(this.cnv.crop.x2))},h.prototype.adjustE=function(t,e){t?this.cnv.crop.y2-(e-this.cnv.crop.x)/this.options.ratio>=0?(this.setWidth(e-this.cnv.crop.x),this.setHeight(Math.round(this.cnv.crop.w/this.options.ratio)),this.setTop(this.cnv.crop.y2-this.cnv.crop.h),this.cnv.crop.x2=e):(this.setTop(0),this.setHeight(this.cnv.crop.y2),this.setWidth(Math.round(this.cnv.crop.h*this.options.ratio)),this.cnv.crop.x2=this.cnv.crop.x+this.cnv.crop.w):(e-this.cnv.crop.x)/this.options.ratio+this.cnv.crop.y<=this.cnv.image.h?(this.setWidth(e-this.cnv.crop.x),this.setHeight(Math.round(this.cnv.crop.w/this.options.ratio)),this.cnv.crop.x2=e,this.cnv.crop.y2=this.cnv.crop.y+this.cnv.crop.h):(this.setHeight(this.cnv.image.h-this.cnv.crop.y),this.setWidth(Math.round(this.cnv.crop.h*this.options.ratio)),this.cnv.crop.y2=this.cnv.image.h,this.cnv.crop.x2=this.cnv.crop.x+this.cnv.crop.w)},h.prototype.setE=function(t){this.options.ratio?this.cnv.cursor.x<this.cnv.image.w?this.cnv.cursor.x>this.cnv.crop.x?this.adjustE(t,this.cnv.cursor.x):(this.setWidth(1),this.setHeight(Math.round(this.cnv.crop.w/this.options.ratio)),t?this.setTop(this.cnv.crop.y2-1):this.cnv.crop.y2=this.cnv.crop.y+this.cnv.crop.h,this.cnv.crop.x2=this.cnv.crop.x+1):this.adjustE(t,this.cnv.image.w):this.cnv.cursor.x<this.cnv.image.w?this.cnv.cursor.x>this.cnv.crop.x?(this.setWidth(this.cnv.cursor.x-this.cnv.crop.x),this.cnv.crop.x2=this.cnv.cursor.x):(this.setWidth(1),this.cnv.crop.x2=this.cnv.crop.x+1):(this.setWidth(this.cnv.image.w-this.cnv.crop.x),this.cnv.crop.x2=this.cnv.image.w)},h.prototype.setNE=function(){this.options.ratio?Math.abs(this.cnv.cursor.x-this.cnv.crop.x2)>Math.abs(this.cnv.cursor.y-this.cnv.crop.y)&&this.cnv.cursor.x<=this.cnv.crop.x2?this.setN():this.cnv.cursor.y>=this.cnv.crop.y?this.setE(!0):this.setN():(this.setN(),this.setE())},h.prototype.setSE=function(){this.options.ratio?Math.abs(this.cnv.cursor.x-this.cnv.crop.x2)>Math.abs(this.cnv.cursor.y-this.cnv.crop.y-this.cnv.crop.h)&&this.cnv.cursor.x<=this.cnv.crop.x2?this.setS():this.cnv.cursor.y<=this.cnv.crop.y+this.cnv.crop.h?this.setE():this.setS():(this.setS(),this.setE())},h.prototype.setSW=function(){this.options.ratio?Math.abs(this.cnv.cursor.x-this.cnv.crop.x)>Math.abs(this.cnv.cursor.y-this.cnv.crop.y-this.cnv.crop.h)&&this.cnv.cursor.x>=this.cnv.crop.x?this.setS(!0):this.cnv.cursor.y<=this.cnv.crop.y+this.cnv.crop.h?this.setW():this.setS(!0):(this.setS(),this.setW())},h.prototype.setNW=function(){this.options.ratio?Math.abs(this.cnv.cursor.x-this.cnv.crop.x)>Math.abs(this.cnv.cursor.y-this.cnv.crop.y)&&this.cnv.cursor.x>=this.cnv.crop.x?this.setN(!0):this.cnv.cursor.y>=this.cnv.crop.y?this.setW(!0):this.setN(!0):(this.setN(),this.setW())},h.prototype.move=function(){var t=this.cnv.cursor.x-this.cnv.cursor.offsetX,e=this.cnv.cursor.y-this.cnv.cursor.offsetY;t>0?t+this.cnv.crop.w<this.cnv.image.w?this.setLeft(t):this.setLeft(this.cnv.image.w-this.cnv.crop.w):this.setLeft(0),e>0?e+this.cnv.crop.h<this.cnv.image.h?this.setTop(e):this.setTop(this.cnv.image.h-this.cnv.crop.h):this.setTop(0),this.cnv.crop.x2=this.cnv.crop.x+this.cnv.crop.w,this.cnv.crop.y2=this.cnv.crop.y+this.cnv.crop.h},h.prototype.dataURItoBlob=function(t){var e,s,i=[];e=-1!==t.split(",")[0].indexOf("base64")?atob(t.split(",")[1]):decodeURI(t.split(",")[1]),s=t.split(",")[0].split(":")[1].split(";")[0];for(var o=0;o<e.length;o++)i[o]=e.charCodeAt(o);return new Blob([new Uint8Array(i)],{type:s})},h.prototype.save=function(){function t(){try{o.drawImage(s.img,s.cnv.toSave.x,s.cnv.toSave.y,s.cnv.toSave.w,s.cnv.toSave.h,0,0,s.cnv.toSave.w,s.cnv.toSave.h)}catch(e){if("NS_ERROR_NOT_AVAILABLE"!=e.name)throw e;setTimeout(t,0)}}var e,s=this,i=document.createElement("canvas"),o=i.getContext("2d");this.cnv.toSave={w:Math.round(this.cnv.crop.w*this.cnv.scale),h:Math.round(this.cnv.crop.h*this.cnv.scale),x:Math.round(this.cnv.crop.x*this.cnv.scale),y:Math.round(this.cnv.crop.y*this.cnv.scale)},i.width=this.cnv.toSave.w,i.height=this.cnv.toSave.h,t(),this.strDataURI=i.toDataURL("image/jpeg",.95),e=new Image,e.src=this.strDataURI,this.setPreviewImage(e),this.file.blob=this.dataURItoBlob(this.strDataURI)},h.prototype.attachData=function(){var t=this;this.form&&("cropped"==this.options.format?this.form.events.on("beforeSend",function(e){t.file&&e.data.append(t.options.name,t.file.blob,t.file.name)}):this.form.events.on("beforeSend",function(e){t.file&&(e.data.append(t.options.name,t.file.file,t.file.name),e.data.append(t.options.name+"-cropData[cropWidth]",t.cnv.toSave.w),e.data.append(t.options.name+"-cropData[cropHeight]",t.cnv.toSave.h),e.data.append(t.options.name+"-cropData[cropX]",t.cnv.toSave.x),e.data.append(t.options.name+"-cropData[cropY]",t.cnv.toSave.y))}))},h.prototype.die=function(){this.removeEventListeners(),this.removeModalEventListeners(),delete this},e["default"]=h},function(t,e,s){"use strict";t.exports={"default":s(4),__esModule:!0}},function(t,e,s){"use strict";var i=s(5);t.exports=function(t,e){return i.create(t,e)}},function(t,e){"use strict";var s=Object;t.exports={create:s.create,getProto:s.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:s.getOwnPropertyDescriptor,setDesc:s.defineProperty,setDescs:s.defineProperties,getKeys:s.keys,getNames:s.getOwnPropertyNames,getSymbols:s.getOwnPropertySymbols,each:[].forEach}},function(t,e){t.exports='<div class=sf-crop-modal><div class=sf-crop-modal-body><div class=sf-crop-container><div class=sf-crop-image-original></div><div class=sf-crop-wrapper><div class=sf-crop-dimmers-container><div class=dimmers><div class="dimmer dimmer-n"></div><div class="dimmer dimmer-e"></div><div class="dimmer dimmer-s"></div><div class="dimmer dimmer-w"></div></div></div><div class=sf-crop-elements><div class="handler handler-n"></div><div class="handler handler-ne"></div><div class="handler handler-e"></div><div class="handler handler-se"></div><div class="handler handler-s"></div><div class="handler handler-sw"></div><div class="handler handler-w"></div><div class="handler handler-nw"></div></div></div></div></div><div class=sf-crop-modal-header><div class=sf-crop-cropper-info><div class=sf-crop-ratio></div><div class=sf-crop-orig-size></div><div class=sf-crop-cropped-size></div></div></div><div class=sf-crop-modal-footer><button class="sf-crop-close btn"></button> <button type=button class="btn sf-crop-save"></button></div></div><div class=sf-crop-backdrop></div>'},function(t,e,s){var i=s(8);"string"==typeof i&&(i=[[t.id,i,""]]);s(10)(i,{});i.locals&&(t.exports=i.locals)},function(t,e,s){e=t.exports=s(9)(),e.push([t.id,".sf-crop-modal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);padding:20px;background-color:#fff;overflow:auto;z-index:1000;width:auto;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;opacity:0;transition:opacity .3s ease;box-shadow:0 16px 28px 0 rgba(0,0,0,.22),0 25px 55px 0 rgba(0,0,0,.21)}.sf-crop-modal.visible{opacity:1;z-index:1001}.sf-crop-modal .sf-crop-modal-footer{padding-top:20px;text-align:right}.sf-crop-modal .btn{display:inline-block;margin:0 0 0 10px;border-width:0;border-radius:2px;box-shadow:0 0 1px rgba(0,0,0,.2);color:#4a4a4a;background:#fff;outline:none}.sf-crop-modal .btn:focus,.sf-crop-modal .btn:hover{background-color:#efefef}.sf-crop-modal .btn.sf-crop-save{box-shadow:0 0 1px rgba(0,0,0,.6)}.sf-crop-modal .btn.sf-crop-close{color:#8a8a8a}.sf-crop-modal .sf-crop-container{position:relative}.sf-crop-modal .sf-crop-container canvas{display:block}.sf-crop-modal .sf-crop-wrapper{position:absolute;top:0;bottom:0;left:0;right:0}.sf-crop-modal .sf-crop-wrapper .sf-crop-elements{position:absolute;border:1px dashed #000;top:0;width:100%;height:100%;max-width:100%;max-height:100%;cursor:move}.sf-crop-modal .sf-crop-wrapper .sf-crop-dimmers-container{position:absolute;overflow:hidden;top:0;bottom:0;left:0;right:0}.sf-crop-modal .sf-crop-wrapper .dimmers{position:absolute}.sf-crop-modal .sf-crop-wrapper .dimmer{position:absolute;width:1000px;height:1000px;background-color:#000;opacity:.3}.sf-crop-modal .sf-crop-wrapper .dimmer.dimmer-n{bottom:100%;left:0}.sf-crop-modal .sf-crop-wrapper .dimmer.dimmer-e{left:100%;top:0}.sf-crop-modal .sf-crop-wrapper .dimmer.dimmer-s{top:100%;right:0}.sf-crop-modal .sf-crop-wrapper .dimmer.dimmer-w{bottom:0;right:100%}.sf-crop-modal .sf-crop-wrapper .handler{position:absolute;border:1px solid #333;width:10px;height:10px;background:#fff;opacity:.5}.sf-crop-modal .sf-crop-wrapper .handler.handler-n{top:0;left:50%;margin-top:-6px;margin-left:-6px;cursor:n-resize}.sf-crop-modal .sf-crop-wrapper .handler.handler-ne{top:0;right:0;margin-top:-6px;margin-right:-6px;cursor:ne-resize}.sf-crop-modal .sf-crop-wrapper .handler.handler-e{top:50%;right:0;margin-top:-6px;margin-right:-6px;cursor:e-resize}.sf-crop-modal .sf-crop-wrapper .handler.handler-se{bottom:0;right:0;margin-bottom:-6px;margin-right:-6px;cursor:se-resize}.sf-crop-modal .sf-crop-wrapper .handler.handler-s{bottom:0;left:50%;margin-bottom:-6px;margin-left:-6px;cursor:s-resize}.sf-crop-modal .sf-crop-wrapper .handler.handler-sw{bottom:0;left:0;margin-bottom:-6px;margin-left:-6px;cursor:sw-resize}.sf-crop-modal .sf-crop-wrapper .handler.handler-w{top:50%;left:0;margin-top:-6px;margin-left:-6px;cursor:w-resize}.sf-crop-modal .sf-crop-wrapper .handler.handler-nw{top:0;left:0;margin-top:-6px;margin-left:-6px;cursor:nw-resize}.sf-crop-modal .sf-crop-modal-header .sf-crop-cropper-info{font-size:12px}.sf-crop-modal .sf-crop-modal-header .sf-crop-close{position:absolute;background:transparent;padding:0;top:10px;right:15px;font-size:24px;border:none;opacity:.2;cursor:pointer}.sf-crop-modal .sf-crop-modal-header .sf-crop-close:hover{opacity:1}.sf-crop-backdrop{top:0;left:0;position:fixed;background-color:#000;width:100vw;height:100vh;opacity:0;transition:opacity .3s ease}.sf-crop-backdrop.visible{opacity:.4;z-index:1000}",""])},function(t,e){"use strict";t.exports=function(){var t=[];return t.toString=function(){for(var t=[],e=0;e<this.length;e++){var s=this[e];s[2]?t.push("@media "+s[2]+"{"+s[1]+"}"):t.push(s[1])}return t.join("")},t.i=function(e,s){"string"==typeof e&&(e=[[null,e,""]]);for(var i={},o=0;o<this.length;o++){var r=this[o][0];"number"==typeof r&&(i[r]=!0)}for(o=0;o<e.length;o++){var n=e[o];"number"==typeof n[0]&&i[n[0]]||(s&&!n[2]?n[2]=s:s&&(n[2]="("+n[2]+") and ("+s+")"),t.push(n))}},t}},function(t,e,s){function i(t,e){for(var s=0;s<t.length;s++){var i=t[s],o=v[i.id];if(o){o.refs++;for(var r=0;r<o.parts.length;r++)o.parts[r](i.parts[r]);for(;r<i.parts.length;r++)o.parts.push(h(i.parts[r],e))}else{for(var n=[],r=0;r<i.parts.length;r++)n.push(h(i.parts[r],e));v[i.id]={id:i.id,refs:1,parts:n}}}}function o(t){for(var e=[],s={},i=0;i<t.length;i++){var o=t[i],r=o[0],n=o[1],c=o[2],a=o[3],h={css:n,media:c,sourceMap:a};s[r]?s[r].parts.push(h):e.push(s[r]={id:r,parts:[h]})}return e}function r(t,e){var s=f(),i=x[x.length-1];if("top"===t.insertAt)i?i.nextSibling?s.insertBefore(e,i.nextSibling):s.appendChild(e):s.insertBefore(e,s.firstChild),x.push(e);else{if("bottom"!==t.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");s.appendChild(e)}}function n(t){t.parentNode.removeChild(t);var e=x.indexOf(t);e>=0&&x.splice(e,1)}function c(t){var e=document.createElement("style");return e.type="text/css",r(t,e),e}function a(t){var e=document.createElement("link");return e.rel="stylesheet",r(t,e),e}function h(t,e){var s,i,o;if(e.singleton){var r=y++;s=g||(g=c(e)),i=p.bind(null,s,r,!1),o=p.bind(null,s,r,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(s=a(e),i=d.bind(null,s),o=function(){n(s),s.href&&URL.revokeObjectURL(s.href)}):(s=c(e),i=l.bind(null,s),o=function(){n(s)});return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else o()}}function p(t,e,s,i){var o=s?"":i.css;if(t.styleSheet)t.styleSheet.cssText=w(e,o);else{var r=document.createTextNode(o),n=t.childNodes;n[e]&&t.removeChild(n[e]),n.length?t.insertBefore(r,n[e]):t.appendChild(r)}}function l(t,e){var s=e.css,i=e.media;e.sourceMap;if(i&&t.setAttribute("media",i),t.styleSheet)t.styleSheet.cssText=s;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(s))}}function d(t,e){var s=e.css,i=(e.media,e.sourceMap);i&&(s+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var o=new Blob([s],{type:"text/css"}),r=t.href;t.href=URL.createObjectURL(o),r&&URL.revokeObjectURL(r)}var v={},u=function(t){var e;return function(){return"undefined"==typeof e&&(e=t.apply(this,arguments)),e}},m=u(function(){return/msie [6-9]\b/.test(window.navigator.userAgent.toLowerCase())}),f=u(function(){return document.head||document.getElementsByTagName("head")[0];
}),g=null,y=0,x=[];t.exports=function(t,e){e=e||{},"undefined"==typeof e.singleton&&(e.singleton=m()),"undefined"==typeof e.insertAt&&(e.insertAt="bottom");var s=o(t);return i(s,e),function(t){for(var r=[],n=0;n<s.length;n++){var c=s[n],a=v[c.id];a.refs--,r.push(a)}if(t){var h=o(t);i(h,e)}for(var n=0;n<r.length;n++){var a=r[n];if(0===a.refs){for(var p=0;p<a.parts.length;p++)a.parts[p]();delete v[a.id]}}}};var w=function(){var t=[];return function(e,s){return t[e]=s,t.filter(Boolean).join("\n")}}()}])});
//# sourceMappingURL=sf.crop.min.js.map